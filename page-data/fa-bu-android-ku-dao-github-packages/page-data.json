{"componentChunkName":"component---src-templates-blog-post-js","path":"/fa-bu-android-ku-dao-github-packages/","result":{"data":{"site":{"siteMetadata":{"title":"Evil Mouth","author":{"name":"Evil Mouth"}}},"markdownRemark":{"id":"406bc4ae-d42f-5a2c-a2cc-d6d1c9f0fff7","excerpt":"原文：https://proandroiddev.com/publishing-android-libraries-to-the-github-package-registry-part-1-7997be54ea5a 推出了自己的包管理服务，目前开源项目免费使用，提供、、、、、，更多信息可以在这里找到 About…","html":"<p>原文：<a href=\"https://proandroiddev.com/publishing-android-libraries-to-the-github-package-registry-part-1-7997be54ea5a\">https://proandroiddev.com/publishing-android-libraries-to-the-github-package-registry-part-1-7997be54ea5a</a></p>\n<!-- More -->\n<p><code class=\"language-text\">GitHub</code>推出了自己的包管理服务，目前开源项目免费使用，提供<code class=\"language-text\">npm</code>、<code class=\"language-text\">gem</code>、<code class=\"language-text\">mvn</code>、<code class=\"language-text\">gradle</code>、<code class=\"language-text\">docker</code>、<code class=\"language-text\">dotnet</code>，更多信息可以在这里找到 <a href=\"https://help.github.com/en/packages/publishing-and-managing-packages/about-github-packages\">About GitHub Packages</a></p>\n<h2>Part 1 - 发布</h2>\n<h3>Step 1 - 生成 GitHub Personal Access Token</h3>\n<ul>\n<li>在你的 GitHub 账户里</li>\n<li>进入 Settings -> Developer Settings -> Personal Access Tokens -> Generate new token</li>\n<li>勾选<code class=\"language-text\">write:packages</code>和<code class=\"language-text\">read:packages</code>生成一个 Token\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"https://cdn.jsdelivr.net/gh/EvilMouth/EvilMouth.github.io@gh-pages/static/17896d7a2407f8d800198c6e9e158f8c/e5166/1.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 14.864864864864865%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAADABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAECBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAdyQqD//xAAWEAADAAAAAAAAAAAAAAAAAAAAAhD/2gAIAQEAAQUCjH//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAQ/9oACAEBAAY/An//xAAXEAEBAQEAAAAAAAAAAAAAAAABABEh/9oACAEBAAE/IQMYCHb/2gAMAwEAAgADAAAAEAAP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGhABAAMAAwAAAAAAAAAAAAAAAQAhMRFRkf/aAAgBAQABPxDIGEAlHkDjRnU//9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"1\"\n        title=\"1\"\n        src=\"https://cdn.jsdelivr.net/gh/EvilMouth/EvilMouth.github.io@gh-pages/static/17896d7a2407f8d800198c6e9e158f8c/1c72d/1.jpg\"\n        srcset=\"https://cdn.jsdelivr.net/gh/EvilMouth/EvilMouth.github.io@gh-pages/static/17896d7a2407f8d800198c6e9e158f8c/a80bd/1.jpg 148w,\nhttps://cdn.jsdelivr.net/gh/EvilMouth/EvilMouth.github.io@gh-pages/static/17896d7a2407f8d800198c6e9e158f8c/1c91a/1.jpg 295w,\nhttps://cdn.jsdelivr.net/gh/EvilMouth/EvilMouth.github.io@gh-pages/static/17896d7a2407f8d800198c6e9e158f8c/1c72d/1.jpg 590w,\nhttps://cdn.jsdelivr.net/gh/EvilMouth/EvilMouth.github.io@gh-pages/static/17896d7a2407f8d800198c6e9e158f8c/a8a14/1.jpg 885w,\nhttps://cdn.jsdelivr.net/gh/EvilMouth/EvilMouth.github.io@gh-pages/static/17896d7a2407f8d800198c6e9e158f8c/fbd2c/1.jpg 1180w,\nhttps://cdn.jsdelivr.net/gh/EvilMouth/EvilMouth.github.io@gh-pages/static/17896d7a2407f8d800198c6e9e158f8c/e5166/1.jpg 1200w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></li>\n<li>生成 Token 后记得复制保存，该 Token 只显示在这一次，之后只能重新生成新的 Token</li>\n</ul>\n<h3>Step 2 - 配置 Token 到你的项目</h3>\n<ul>\n<li>在你的项目根目录新建一个<code class=\"language-text\">.properties</code>文件，比如<code class=\"language-text\">github.properties</code></li>\n<li>添加两个属性<code class=\"language-text\">gpr.usr=GITHUB_USERID</code> <code class=\"language-text\">gpr.key=PERSONAL_ACCESS_TOKEN</code></li>\n<li><code class=\"language-text\">GITHUB_USERID</code>替换成你的 GitHub 账户 Id，<code class=\"language-text\">PERSONAL_ACCESS_TOKEN</code>替换成 Step 1 生成的 Token</li>\n<li>如果你的项目是开源项目，记得将<code class=\"language-text\">.properties</code>文件添加到<code class=\"language-text\">.gitignore</code>，以免泄露 Token</li>\n</ul>\n<blockquote>\n<p>你也可以通过环境变量来传入<code class=\"language-text\">GPR_USER</code>和<code class=\"language-text\">GPR_API_KEY</code>，就不需要<code class=\"language-text\">.properties</code>文件</p>\n</blockquote>\n<h3>Step 3 - 更新 library module 的 build.gradle</h3>\n<ul>\n<li>将下方代码添加到 library module 的 build.gradle 文件</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"groovy\"><pre class=\"language-groovy\"><code class=\"language-groovy\">apply plugin<span class=\"token punctuation\">:</span> <span class=\"token string\">'maven-publish'</span> <span class=\"token comment\">// 添加到library build.gradle的最上面</span>\n\n<span class=\"token keyword\">def</span> githubProperties <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Properties</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\ngithubProperties<span class=\"token punctuation\">.</span><span class=\"token function\">load</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">FileInputStream</span><span class=\"token punctuation\">(</span>rootProject<span class=\"token punctuation\">.</span><span class=\"token function\">file</span><span class=\"token punctuation\">(</span><span class=\"token string gstring\">\"github.properties\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">def</span> getVersionName <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> <span class=\"token operator\">-></span>\n <span class=\"token keyword\">return</span> <span class=\"token string gstring\">\"1.0.2\"</span> <span class=\"token comment\">// 仓库版本</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">def</span> getArtificatId <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> <span class=\"token operator\">-></span>\n <span class=\"token keyword\">return</span> <span class=\"token string gstring\">\"sampleAndroidLib\"</span> <span class=\"token comment\">// 仓库Id</span>\n<span class=\"token punctuation\">}</span>\n\npublishing <span class=\"token punctuation\">{</span>\n publications <span class=\"token punctuation\">{</span>\n   <span class=\"token function\">bar</span><span class=\"token punctuation\">(</span>MavenPublication<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      groupId <span class=\"token string\">'com.enefce.libraries'</span> <span class=\"token comment\">// 仓库组Id</span>\n      artifactId <span class=\"token function\">getArtificatId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      version <span class=\"token function\">getVersionName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token function\">artifact</span><span class=\"token punctuation\">(</span><span class=\"token string gstring\">\"<span class=\"token expression\"><span class=\"token punctuation\">$</span>buildDir</span>/outputs/aar/<span class=\"token expression\"><span class=\"token punctuation\">$</span><span class=\"token punctuation\">{</span><span class=\"token function\">getArtificatId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span>-release.aar\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n <span class=\"token punctuation\">}</span>\n\nrepositories <span class=\"token punctuation\">{</span>\n        maven <span class=\"token punctuation\">{</span>\n               name <span class=\"token operator\">=</span> <span class=\"token string gstring\">\"GitHubPackages\"</span>\n        <span class=\"token comment\">/** Configure path of your package repository on Github\n         ** GITHUB_USERID替换成你的GitHub账户Id\n         ** REPOSITORY替换成你的项目名称\n        */</span>\n url <span class=\"token operator\">=</span> <span class=\"token function\">uri</span><span class=\"token punctuation\">(</span><span class=\"token string gstring\">\"https://maven.pkg.github.com/GITHUB_USERID/REPOSITORY\"</span><span class=\"token punctuation\">)</span>\ncredentials <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">/** Create github.properties in root project folder file with\n         ** gpr.usr=GITHUB_USER_ID &amp; gpr.key=PERSONAL_ACCESS_TOKEN\n         ** Set env variable GPR_USER &amp; GPR_API_KEY if not adding a properties file**/</span>\n\n         username <span class=\"token operator\">=</span> githubProperties<span class=\"token punctuation\">[</span><span class=\"token string\">'gpr.usr'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">?:</span> System<span class=\"token punctuation\">.</span><span class=\"token function\">getenv</span><span class=\"token punctuation\">(</span><span class=\"token string gstring\">\"GPR_USER\"</span><span class=\"token punctuation\">)</span>\n         password <span class=\"token operator\">=</span> githubProperties<span class=\"token punctuation\">[</span><span class=\"token string\">'gpr.key'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">?:</span> System<span class=\"token punctuation\">.</span><span class=\"token function\">getenv</span><span class=\"token punctuation\">(</span><span class=\"token string gstring\">\"GPR_API_KEY\"</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3>Step 4 - 执行发布</h3>\n<blockquote>\n<p>在执行发布之前需要确保编译过，也就是<code class=\"language-text\">build</code>命令，并能在<code class=\"language-text\">build/outputs/aar/</code>路径找到编译后的 aar 文件</p>\n</blockquote>\n<ul>\n<li>在你的 library module 任务下找到<code class=\"language-text\">publishing/publish</code>并执行，或者直接命令行</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ gradle publish</code></pre></div>\n<ul>\n<li>当任务成功后就可以在你的 GitHub 账户下的<code class=\"language-text\">Packages</code>栏找到该包\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"https://cdn.jsdelivr.net/gh/EvilMouth/EvilMouth.github.io@gh-pages/static/e9386d50d97d62424a3aa8ecd2852199/e5166/2.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 25.675675675675674%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAFABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAIF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB3KCAf//EABYQAAMAAAAAAAAAAAAAAAAAAAABEP/aAAgBAQABBQKM/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAEP/aAAgBAQAGPwJ//8QAGRABAAIDAAAAAAAAAAAAAAAAAQARITFR/9oACAEBAAE/IQEMEo5CXqf/2gAMAwEAAgADAAAAEHPP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAHBAAAgAHAAAAAAAAAAAAAAAAACEBETFBUWGR/9oACAEBAAE/EEkKFjU4SBKYP//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2\"\n        title=\"2\"\n        src=\"https://cdn.jsdelivr.net/gh/EvilMouth/EvilMouth.github.io@gh-pages/static/e9386d50d97d62424a3aa8ecd2852199/1c72d/2.jpg\"\n        srcset=\"https://cdn.jsdelivr.net/gh/EvilMouth/EvilMouth.github.io@gh-pages/static/e9386d50d97d62424a3aa8ecd2852199/a80bd/2.jpg 148w,\nhttps://cdn.jsdelivr.net/gh/EvilMouth/EvilMouth.github.io@gh-pages/static/e9386d50d97d62424a3aa8ecd2852199/1c91a/2.jpg 295w,\nhttps://cdn.jsdelivr.net/gh/EvilMouth/EvilMouth.github.io@gh-pages/static/e9386d50d97d62424a3aa8ecd2852199/1c72d/2.jpg 590w,\nhttps://cdn.jsdelivr.net/gh/EvilMouth/EvilMouth.github.io@gh-pages/static/e9386d50d97d62424a3aa8ecd2852199/a8a14/2.jpg 885w,\nhttps://cdn.jsdelivr.net/gh/EvilMouth/EvilMouth.github.io@gh-pages/static/e9386d50d97d62424a3aa8ecd2852199/fbd2c/2.jpg 1180w,\nhttps://cdn.jsdelivr.net/gh/EvilMouth/EvilMouth.github.io@gh-pages/static/e9386d50d97d62424a3aa8ecd2852199/e5166/2.jpg 1200w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></li>\n<li>如果任务失败，可以跟<code class=\"language-text\">–stacktrace</code>、<code class=\"language-text\">–info</code>或者<code class=\"language-text\">-debug</code>一起执行查看日志</li>\n</ul>\n<blockquote>\n<p>注意：</p>\n</blockquote>\n<h2>Part 2 - 安装</h2>\n<blockquote>\n<p>如果是私有项目还需要生成一个<code class=\"language-text\">read:packages</code>的 Token，生成步骤见 Part 1</p>\n</blockquote>\n<h3>Step 1 - 更新项目的根 build.gradle</h3>\n<ul>\n<li>将下方代码添加到根 build.gradle 文件</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"groovy\"><pre class=\"language-groovy\"><code class=\"language-groovy\">allprojects <span class=\"token punctuation\">{</span>\n    repositories <span class=\"token punctuation\">{</span>\n        maven <span class=\"token punctuation\">{</span>\n          name <span class=\"token operator\">=</span> <span class=\"token string gstring\">\"GitHubPackages\"</span>\n          <span class=\"token comment\">/**\n          ** GITHUB_USERID替换成刚才发布包的GitHub账号Id\n          ** REPOSITORY替换成刚才发布包的项目名称\n          */</span>\n          url <span class=\"token operator\">=</span> <span class=\"token function\">uri</span><span class=\"token punctuation\">(</span><span class=\"token string gstring\">\"https://maven.pkg.github.com/GITHUB_USERID/REPOSITORY\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>添加依赖到 app.module 文件</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"groovy\"><pre class=\"language-groovy\"><code class=\"language-groovy\">dependencies <span class=\"token punctuation\">{</span>\n  implementation <span class=\"token string\">'com.example:package'</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>同步</li>\n</ul>\n<h2>Part 3 - 便携发布</h2>\n<div class=\"gatsby-highlight\" data-language=\"groovy\"><pre class=\"language-groovy\"><code class=\"language-groovy\">apply from<span class=\"token punctuation\">:</span> <span class=\"token string\">'https://raw.githubusercontent.com/izyhang/GitHub-Packages-Publish/master/publish.gradle'</span></code></pre></div>","frontmatter":{"title":"发布Android库到GitHub Packages","date":"March 09, 2020","tags":["libraries","gradle","github packages"],"categories":"Android"}}},"pageContext":{"slug":"/fa-bu-android-ku-dao-github-packages/","previous":{"fields":{"slug":"/qianqianqianhouhouhou/"},"frontmatter":{"title":"前前前后后后"}},"next":{"fields":{"slug":"/alipay-tinyapp-zhi-ding-ye-mian-tiao-zhuan/"},"frontmatter":{"title":"支付宝小程序指定页面跳转"}}}},"staticQueryHashes":["2841359383"]}
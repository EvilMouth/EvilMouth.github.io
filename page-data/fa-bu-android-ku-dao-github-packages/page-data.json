{"componentChunkName":"component---src-templates-blog-post-js","path":"/fa-bu-android-ku-dao-github-packages/","result":{"data":{"site":{"siteMetadata":{"title":"Evil Mouth","author":{"name":"Evil Mouth"}}},"markdownRemark":{"id":"406bc4ae-d42f-5a2c-a2cc-d6d1c9f0fff7","excerpt":"原文：https://proandroiddev.com/publishing-android-libraries-to-the-github-package-registry-part-1-7997be54ea5a 推出了自己的包管理服务，目前开源项目免费使用，提供、、、、、，更多信息可以在这里找到 About…","html":"<p>原文：<a href=\"https://proandroiddev.com/publishing-android-libraries-to-the-github-package-registry-part-1-7997be54ea5a\">https://proandroiddev.com/publishing-android-libraries-to-the-github-package-registry-part-1-7997be54ea5a</a></p>\n<!-- More -->\n<p><code class=\"language-text\">GitHub</code>推出了自己的包管理服务，目前开源项目免费使用，提供<code class=\"language-text\">npm</code>、<code class=\"language-text\">gem</code>、<code class=\"language-text\">mvn</code>、<code class=\"language-text\">gradle</code>、<code class=\"language-text\">docker</code>、<code class=\"language-text\">dotnet</code>，更多信息可以在这里找到 <a href=\"https://help.github.com/en/packages/publishing-and-managing-packages/about-github-packages\">About GitHub Packages</a></p>\n<h2>Part 1 - 发布</h2>\n<h3>Step 1 - 生成GitHub Personal Access Token</h3>\n<ul>\n<li>在你的GitHub账户里</li>\n<li>进入 Settings -> Developer Settings -> Personal Access Tokens -> Generate new token</li>\n<li>勾选<code class=\"language-text\">write:packages</code>和<code class=\"language-text\">read:packages</code>生成一个Token\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/17896d7a2407f8d800198c6e9e158f8c/e5166/1.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 14.864864864864865%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAADABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAECBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAdyQqD//xAAWEAADAAAAAAAAAAAAAAAAAAAAAhD/2gAIAQEAAQUCjH//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAQ/9oACAEBAAY/An//xAAXEAEBAQEAAAAAAAAAAAAAAAABABEh/9oACAEBAAE/IQMYCHb/2gAMAwEAAgADAAAAEAAP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGhABAAMAAwAAAAAAAAAAAAAAAQAhMRFRkf/aAAgBAQABPxDIGEAlHkDjRnU//9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"1\"\n        title=\"1\"\n        src=\"/static/17896d7a2407f8d800198c6e9e158f8c/1c72d/1.jpg\"\n        srcset=\"/static/17896d7a2407f8d800198c6e9e158f8c/a80bd/1.jpg 148w,\n/static/17896d7a2407f8d800198c6e9e158f8c/1c91a/1.jpg 295w,\n/static/17896d7a2407f8d800198c6e9e158f8c/1c72d/1.jpg 590w,\n/static/17896d7a2407f8d800198c6e9e158f8c/a8a14/1.jpg 885w,\n/static/17896d7a2407f8d800198c6e9e158f8c/fbd2c/1.jpg 1180w,\n/static/17896d7a2407f8d800198c6e9e158f8c/e5166/1.jpg 1200w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></li>\n<li>生成Token后记得复制保存，该Token只显示在这一次，之后只能重新生成新的Token</li>\n</ul>\n<h3>Step 2 - 配置Token到你的项目</h3>\n<ul>\n<li>在你的项目根目录新建一个<code class=\"language-text\">.properties</code>文件，比如<code class=\"language-text\">github.properties</code></li>\n<li>添加两个属性<code class=\"language-text\">gpr.usr=GITHUB_USERID</code> <code class=\"language-text\">gpr.key=PERSONAL_ACCESS_TOKEN</code></li>\n<li><code class=\"language-text\">GITHUB_USERID</code>替换成你的GitHub账户Id，<code class=\"language-text\">PERSONAL_ACCESS_TOKEN</code>替换成Step 1生成的Token</li>\n<li>如果你的项目是开源项目，记得将<code class=\"language-text\">.properties</code>文件添加到<code class=\"language-text\">.gitignore</code>，以免泄露Token</li>\n</ul>\n<blockquote>\n<p>你也可以通过环境变量来传入<code class=\"language-text\">GPR_USER</code>和<code class=\"language-text\">GPR_API_KEY</code>，就不需要<code class=\"language-text\">.properties</code>文件</p>\n</blockquote>\n<h3>Step 3 - 更新library module的build.gradle</h3>\n<ul>\n<li>\n<p>将下方代码添加到library module的build.gradle文件</p>\n<div class=\"gatsby-highlight\" data-language=\"gradle\"><pre class=\"language-gradle\"><code class=\"language-gradle\">apply plugin: &#39;maven-publish&#39; // 添加到library build.gradle的最上面</code></pre></div>\n</li>\n</ul>\n<p>def githubProperties = new Properties()\ngithubProperties.load(new FileInputStream(rootProject.file(“github.properties”)))</p>\n<p>def getVersionName = { ->\nreturn “1.0.2” // 仓库版本\n}</p>\n<p>def getArtificatId = { ->\nreturn “sampleAndroidLib” // 仓库Id\n}</p>\n<p>publishing {\npublications {\nbar(MavenPublication) {\ngroupId ‘com.enefce.libraries’ // 仓库组Id\nartifactId getArtificatId()\nversion getVersionName()\nartifact(“$buildDir/outputs/aar/${getArtificatId()}-release.aar”)\n}\n}</p>\n<p>repositories {\nmaven {\nname = “GitHubPackages”\n/** Configure path of your package repository on Github\n** GITHUB<em>USERID替换成你的GitHub账户Id<br>\n** REPOSITORY替换成你的项目名称\n*/\nurl = uri(”<a href=\"https://maven.pkg.github.com/GITHUB\">https://maven.pkg.github.com/GITHUB</a></em>USERID/REPOSITORY”)\ncredentials {\n/** Create github.properties in root project folder file with<br>\n** gpr.usr=GITHUB<em>USER</em>ID &#x26; gpr.key=PERSONAL<em>ACCESS</em>TOKEN\n** Set env variable GPR<em>USER &#x26; GPR</em>API_KEY if not adding a properties file**/</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">     username = githubProperties[&#39;gpr.usr&#39;] ?: System.getenv(&quot;GPR_USER&quot;)\n     password = githubProperties[&#39;gpr.key&#39;] ?: System.getenv(&quot;GPR_API_KEY&quot;)\n  }\n}</code></pre></div>\n<p>  }\n}</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">### Step 4 - 执行发布\n\n&gt; 在执行发布之前需要确保编译过，也就是`build`命令，并能在`build/outputs/aar/`路径找到编译后的aar文件\n\n- 在你的library module任务下找到`publishing/publish`并执行，或者直接命令行\n``` shell\n$ gradle publish</code></pre></div>\n<ul>\n<li>当任务成功后就可以在你的GitHub账户下的<code class=\"language-text\">Packages</code>栏找到该包\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e9386d50d97d62424a3aa8ecd2852199/e5166/2.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 25.675675675675674%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAFABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAIF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB3KCAf//EABYQAAMAAAAAAAAAAAAAAAAAAAABEP/aAAgBAQABBQKM/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAEP/aAAgBAQAGPwJ//8QAGRABAAIDAAAAAAAAAAAAAAAAAQARITFR/9oACAEBAAE/IQEMEo5CXqf/2gAMAwEAAgADAAAAEHPP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAHBAAAgAHAAAAAAAAAAAAAAAAACEBETFBUWGR/9oACAEBAAE/EEkKFjU4SBKYP//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2\"\n        title=\"2\"\n        src=\"/static/e9386d50d97d62424a3aa8ecd2852199/1c72d/2.jpg\"\n        srcset=\"/static/e9386d50d97d62424a3aa8ecd2852199/a80bd/2.jpg 148w,\n/static/e9386d50d97d62424a3aa8ecd2852199/1c91a/2.jpg 295w,\n/static/e9386d50d97d62424a3aa8ecd2852199/1c72d/2.jpg 590w,\n/static/e9386d50d97d62424a3aa8ecd2852199/a8a14/2.jpg 885w,\n/static/e9386d50d97d62424a3aa8ecd2852199/fbd2c/2.jpg 1180w,\n/static/e9386d50d97d62424a3aa8ecd2852199/e5166/2.jpg 1200w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></li>\n<li>如果任务失败，可以跟<code class=\"language-text\">–stacktrace</code>、<code class=\"language-text\">–info</code>或者<code class=\"language-text\">-debug</code>一起执行查看日志</li>\n</ul>\n<blockquote>\n<p>注意：</p>\n</blockquote>\n<h2>Part 2 - 安装</h2>\n<blockquote>\n<p>如果是私有项目还需要生成一个<code class=\"language-text\">read:packages</code>的Token，生成步骤见Part 1</p>\n</blockquote>\n<h3>Step 1 - 更新项目的根build.gradle</h3>\n<ul>\n<li>\n<p>将下方代码添加到根build.gradle文件</p>\n<div class=\"gatsby-highlight\" data-language=\"gradle\"><pre class=\"language-gradle\"><code class=\"language-gradle\">allprojects {\nrepositories {\n    maven {\n      name = &quot;GitHubPackages&quot;\n      /**\n      ** GITHUB_USERID替换成刚才发布包的GitHub账号Id\n      ** REPOSITORY替换成刚才发布包的项目名称\n      */\n      url = uri(&quot;https://maven.pkg.github.com/GITHUB_USERID/REPOSITORY&quot;)\n    }\n}\n}</code></pre></div>\n</li>\n<li>\n<p>添加依赖到app.module文件</p>\n<div class=\"gatsby-highlight\" data-language=\"gradle\"><pre class=\"language-gradle\"><code class=\"language-gradle\">dependencies {\nimplementation &#39;com.example:package&#39;\n}</code></pre></div>\n</li>\n<li>同步</li>\n</ul>\n<h2>Part 3 - 便携发布</h2>\n<div class=\"gatsby-highlight\" data-language=\"gradle\"><pre class=\"language-gradle\"><code class=\"language-gradle\">apply from: &#39;https://raw.githubusercontent.com/izyhang/GitHub-Packages-Publish/master/publish.gradle&#39;</code></pre></div>","frontmatter":{"title":"发布Android库到GitHub Packages","date":"March 09, 2020","tags":["libraries","gradle","github packages"],"categories":"Android"}}},"pageContext":{"slug":"/fa-bu-android-ku-dao-github-packages/","previous":{"fields":{"slug":"/qianqianqianhouhouhou/"},"frontmatter":{"title":"前前前后后后"}},"next":{"fields":{"slug":"/alipay-tinyapp-zhi-ding-ye-mian-tiao-zhuan/"},"frontmatter":{"title":"支付宝小程序指定页面跳转"}}}},"staticQueryHashes":["2841359383"]}
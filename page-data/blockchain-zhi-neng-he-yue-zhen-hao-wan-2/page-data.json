{"componentChunkName":"component---src-templates-blog-post-js","path":"/blockchain-zhi-neng-he-yue-zhen-hao-wan-2/","result":{"data":{"site":{"siteMetadata":{"title":"Evil Mouth","author":{"name":"Evil Mouth"}}},"markdownRemark":{"id":"d85cac06-e2e8-57f4-b915-05d44c3e2df3","excerpt":"address vs address payable 在solidity 5.0版本之后，address被拆分成address和address payable\n 在5.0之后，address将失去功能，得声明成address payable才有 msg.sender是一个address payable address…","html":"<h3>address vs address payable</h3>\n<p>在solidity 5.0版本之后，address被拆分成address和address payable\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/05cb097feb40655fe8f6f5b0c9a810de/991bb/1.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 25.675675675675674%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAFABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB2qFB/8QAFBABAAAAAAAAAAAAAAAAAAAAEP/aAAgBAQABBQJ//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAEP/aAAgBAQAGPwJ//8QAFhABAQEAAAAAAAAAAAAAAAAAAAER/9oACAEBAAE/IWI//9oADAMBAAIAAwAAABB3z//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABoQAQACAwEAAAAAAAAAAAAAAAEAESFBUWH/2gAIAQEAAT8QXL4wtuKjs//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"1\"\n        title=\"1\"\n        src=\"/static/05cb097feb40655fe8f6f5b0c9a810de/1c72d/1.jpg\"\n        srcset=\"/static/05cb097feb40655fe8f6f5b0c9a810de/a80bd/1.jpg 148w,\n/static/05cb097feb40655fe8f6f5b0c9a810de/1c91a/1.jpg 295w,\n/static/05cb097feb40655fe8f6f5b0c9a810de/1c72d/1.jpg 590w,\n/static/05cb097feb40655fe8f6f5b0c9a810de/a8a14/1.jpg 885w,\n/static/05cb097feb40655fe8f6f5b0c9a810de/fbd2c/1.jpg 1180w,\n/static/05cb097feb40655fe8f6f5b0c9a810de/991bb/1.jpg 1416w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>在5.0之后，address将失去<code class=\"language-text\">transfer</code>功能，得声明成address payable才有</p>\n<blockquote>\n<p>msg.sender是一个address payable</p>\n</blockquote>\n<!-- More -->\n<h3>address 转 address payable</h3>\n<div class=\"gatsby-highlight\" data-language=\"sol\"><pre class=\"language-sol\"><code class=\"language-sol\"><span class=\"token builtin\">address</span> addr <span class=\"token operator\">=</span> xxx<span class=\"token punctuation\">;</span>\n<span class=\"token builtin\">address</span> <span class=\"token keyword\">payable</span> addr1 <span class=\"token operator\">=</span> <span class=\"token builtin\">address</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">uint160</span><span class=\"token punctuation\">(</span>addr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h3>address payable 转 address</h3>\n<div class=\"gatsby-highlight\" data-language=\"sol\"><pre class=\"language-sol\"><code class=\"language-sol\"><span class=\"token builtin\">address</span> <span class=\"token keyword\">payable</span> addr <span class=\"token operator\">=</span> xxx<span class=\"token punctuation\">;</span>\n<span class=\"token builtin\">address</span> addr1 <span class=\"token operator\">=</span> <span class=\"token builtin\">address</span><span class=\"token punctuation\">(</span>addr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3>合约支持接收eth</h3>\n<p>要使合约支持接收eth转账，需要声明payable函数，例如回退函数</p>\n<div class=\"gatsby-highlight\" data-language=\"sol\"><pre class=\"language-sol\"><code class=\"language-sol\"><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">external</span> <span class=\"token keyword\">payable</span> <span class=\"token punctuation\">{</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<blockquote>\n<p>!!! 如果合约支持接收eth，那么最好声明对应的提取eth函数，例如</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"sol\"><pre class=\"language-sol\"><code class=\"language-sol\"><span class=\"token keyword\">function</span> <span class=\"token function\">withdraw</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">external</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">.</span>sender <span class=\"token operator\">==</span> owner<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    msg<span class=\"token punctuation\">.</span>sender<span class=\"token punctuation\">.</span><span class=\"token function\">transfer</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">address</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>balance<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3>payable测试</h3>\n<p>可以在remix上测试payable函数，填入Value数值调用即可\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d5814a128ac916d2dbeed2d1b368befc/a77ef/2.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 13.513513513513512%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAADABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAECBf/EABQBAQAAAAAAAAAAAAAAAAAAAAH/2gAMAwEAAhADEAAAAdyBLgf/xAAVEAEBAAAAAAAAAAAAAAAAAAABEP/aAAgBAQABBQJv/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAEP/aAAgBAQAGPwJ//8QAGBAAAgMAAAAAAAAAAAAAAAAAAAEQITH/2gAIAQEAAT8hwoSo/9oADAMBAAIAAwAAABD4D//EABYRAAMAAAAAAAAAAAAAAAAAAAEQMf/aAAgBAwEBPxA1f//EABYRAAMAAAAAAAAAAAAAAAAAAAEQMf/aAAgBAgEBPxARf//EABoQAAICAwAAAAAAAAAAAAAAAAABETEhUcH/2gAIAQEAAT8Qw6itCIXWz//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2\"\n        title=\"2\"\n        src=\"/static/d5814a128ac916d2dbeed2d1b368befc/1c72d/2.jpg\"\n        srcset=\"/static/d5814a128ac916d2dbeed2d1b368befc/a80bd/2.jpg 148w,\n/static/d5814a128ac916d2dbeed2d1b368befc/1c91a/2.jpg 295w,\n/static/d5814a128ac916d2dbeed2d1b368befc/1c72d/2.jpg 590w,\n/static/d5814a128ac916d2dbeed2d1b368befc/a77ef/2.jpg 706w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h3>ERC20规范</h3>\n<p>decimals需要先声明为uint8，再强转成uint256，例如定义500w总量</p>\n<div class=\"gatsby-highlight\" data-language=\"sol\"><pre class=\"language-sol\"><code class=\"language-sol\"><span class=\"token builtin\">uint8</span> <span class=\"token keyword\">public</span> <span class=\"token keyword\">constant</span> decimals <span class=\"token operator\">=</span> <span class=\"token number\">18</span><span class=\"token punctuation\">;</span>\n<span class=\"token builtin\">uint256</span> <span class=\"token keyword\">public</span> totalSupply <span class=\"token operator\">=</span> <span class=\"token number\">5000000</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token number\">10</span> <span class=\"token operator\">**</span> <span class=\"token builtin\">uint256</span><span class=\"token punctuation\">(</span>decimals<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3>gas不足</h3>\n<p>当合约代码中存在的操作越来越多，对应的gas消耗也会越来越多（具体可以看官方的gas计算方式），那么在部署或者进行函数调用时，可能会出现失败的情况</p>\n<p>例如在remix部署合约时出现\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ebf0078635ecd97eb4a7fb9a8db794c8/f585d/3.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 16.216216216216214%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAADABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEE/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB30KD/8QAFBABAAAAAAAAAAAAAAAAAAAAEP/aAAgBAQABBQJ//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAEP/aAAgBAQAGPwJ//8QAFhAAAwAAAAAAAAAAAAAAAAAAAAEQ/9oACAEBAAE/IRT/2gAMAwEAAgADAAAAEPPP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGBAAAgMAAAAAAAAAAAAAAAAAAAEQITH/2gAIAQEAAT8QWlo//9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"3\"\n        title=\"3\"\n        src=\"/static/ebf0078635ecd97eb4a7fb9a8db794c8/1c72d/3.jpg\"\n        srcset=\"/static/ebf0078635ecd97eb4a7fb9a8db794c8/a80bd/3.jpg 148w,\n/static/ebf0078635ecd97eb4a7fb9a8db794c8/1c91a/3.jpg 295w,\n/static/ebf0078635ecd97eb4a7fb9a8db794c8/1c72d/3.jpg 590w,\n/static/ebf0078635ecd97eb4a7fb9a8db794c8/a8a14/3.jpg 885w,\n/static/ebf0078635ecd97eb4a7fb9a8db794c8/fbd2c/3.jpg 1180w,\n/static/ebf0078635ecd97eb4a7fb9a8db794c8/f585d/3.jpg 1566w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>这些情况都可能是设定的gas limit过低，需要消耗的gas超过了limit导致调用失败，遇到这种情况都可以通过上调gas支出解决</p>","frontmatter":{"title":"智能合约真好玩（二）","date":"January 09, 2019","tags":["ethereum","contract"],"categories":"Blockchain"}}},"pageContext":{"slug":"/blockchain-zhi-neng-he-yue-zhen-hao-wan-2/","previous":{"fields":{"slug":"/blockchain-zhi-neng-he-yue-zhen-hao-wan/"},"frontmatter":{"title":"智能合约真好玩"}},"next":{"fields":{"slug":"/android-kotlin-layoutcontainer/"},"frontmatter":{"title":"Kotlin androidExtensions findViewById缓存问题"}}}},"staticQueryHashes":["2841359383"]}
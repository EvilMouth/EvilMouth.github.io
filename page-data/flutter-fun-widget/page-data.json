{"componentChunkName":"component---src-templates-blog-post-js","path":"/flutter-fun-widget/","result":{"data":{"site":{"siteMetadata":{"title":"Evil Mouth's Blog"}},"markdownRemark":{"id":"4ed845ac-31d5-5e9e-8947-536591e8d5c0","excerpt":"本文介绍日常开发中比较实用的Flutter Widget Placeholder 占位图 常用在异步加载请求时先使用Placeholder代替显示，请求结束后替换 Form 表单 例如登陆页面，利用Form Widget将用户名和密码两个输入框包起来，通过Key进行统一校验，还自带返回按键监听 在Form…","html":"<p>本文介绍日常开发中比较实用的Flutter Widget</p>\n<h2>Placeholder 占位图</h2>\n<p>常用在异步加载请求时先使用Placeholder代替显示，请求结束后替换</p>\n<div class=\"gatsby-highlight\" data-language=\"dart\"><pre class=\"language-dart\"><code class=\"language-dart\"><span class=\"token keyword\">const</span> <span class=\"token function\">Placeholder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  Key key<span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>color <span class=\"token operator\">=</span> <span class=\"token keyword\">const</span> <span class=\"token function\">Color</span><span class=\"token punctuation\">(</span><span class=\"token number\">0xFF455A64</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// BlueGrey 700</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>strokeWidth <span class=\"token operator\">=</span> <span class=\"token number\">2.0</span><span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>fallbackWidth <span class=\"token operator\">=</span> <span class=\"token number\">400.0</span><span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>fallbackHeight <span class=\"token operator\">=</span> <span class=\"token number\">400.0</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2>Form 表单</h2>\n<p>例如登陆页面，利用Form Widget将用户名和密码两个输入框包起来，通过Key进行统一校验，还自带返回按键监听</p>\n<div class=\"gatsby-highlight\" data-language=\"dart\"><pre class=\"language-dart\"><code class=\"language-dart\"><span class=\"token keyword\">const</span> <span class=\"token function\">Form</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  Key key<span class=\"token punctuation\">,</span>\n  <span class=\"token metadata symbol\">@required</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>child<span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>autovalidate <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 自动校验</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>onWillPop<span class=\"token punctuation\">,</span> <span class=\"token comment\">// 返回按键监听</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>onChanged<span class=\"token punctuation\">,</span> <span class=\"token comment\">// 表单内容变化</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<blockquote>\n<p>在Form里使用的输入框目前只提供TextFormField和DropdownButtonFormField，两者都继承FormField，可自行扩展</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"dart\"><pre class=\"language-dart\"><code class=\"language-dart\"><span class=\"token function\">Form</span><span class=\"token punctuation\">(</span>\n  key<span class=\"token punctuation\">:</span> _formKey<span class=\"token punctuation\">,</span> <span class=\"token comment\">// 通过key拿到FormState</span>\n  child<span class=\"token punctuation\">:</span> <span class=\"token function\">Column</span><span class=\"token punctuation\">(</span>\n    crossAxisAlignment<span class=\"token punctuation\">:</span> CrossAxisAlignment<span class=\"token punctuation\">.</span>start<span class=\"token punctuation\">,</span>\n    children<span class=\"token punctuation\">:</span> <span class=\"token operator\">&lt;</span>Widget<span class=\"token operator\">></span><span class=\"token punctuation\">[</span>\n      <span class=\"token function\">TextFormField</span><span class=\"token punctuation\">(</span>\n        decoration<span class=\"token punctuation\">:</span> <span class=\"token keyword\">const</span> <span class=\"token function\">InputDecoration</span><span class=\"token punctuation\">(</span>\n          hintText<span class=\"token punctuation\">:</span> <span class=\"token string\">'Enter your email'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        validator<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">.</span>isEmpty<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token string\">'Please enter your email'</span><span class=\"token punctuation\">;</span>\n          <span class=\"token punctuation\">}</span>\n          <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 表示无错误</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        onSaved<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          _formEmail <span class=\"token operator\">=</span> value<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token comment\">//TODO 密码输入框同理</span>\n      <span class=\"token function\">Padding</span><span class=\"token punctuation\">(</span>\n        padding<span class=\"token punctuation\">:</span> <span class=\"token keyword\">const</span> EdgeInsets<span class=\"token punctuation\">.</span><span class=\"token function\">symmetric</span><span class=\"token punctuation\">(</span>vertical<span class=\"token punctuation\">:</span> <span class=\"token number\">16.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        child<span class=\"token punctuation\">:</span> <span class=\"token function\">RaisedButton</span><span class=\"token punctuation\">(</span>\n          onPressed<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// Validate will return true if the form ivalid, or false if</span>\n            <span class=\"token comment\">// the form is invalid.</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>_formKey<span class=\"token punctuation\">.</span>currentState<span class=\"token punctuation\">.</span><span class=\"token function\">validate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n              <span class=\"token comment\">// Process data.</span>\n              _formKey<span class=\"token punctuation\">.</span>currentState<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 触发FormField#onSaved回调</span>\n            <span class=\"token punctuation\">}</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n          child<span class=\"token punctuation\">:</span> <span class=\"token function\">Text</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Submit'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<h3>FormField为何要被包在Form里面</h3>\n<p>Form是个StatefuleWidget，state是FormState，FormState提供了一些操作FormField的方法，比如validate、save。如何获取呢，原因在FormField的build()方法内向上获取到Form，并将自己注册给Form</p>\n<div class=\"gatsby-highlight\" data-language=\"dart\"><pre class=\"language-dart\"><code class=\"language-dart\"><span class=\"token metadata symbol\">@override</span>\nWidget <span class=\"token function\">build</span><span class=\"token punctuation\">(</span>BuildContext context<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  Form<span class=\"token punctuation\">.</span><span class=\"token function\">of</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">)</span><span class=\"token operator\">?</span><span class=\"token punctuation\">.</span><span class=\"token function\">_register</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 将自己注册给Form</span>\n  <span class=\"token keyword\">return</span> widget<span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<blockquote>\n<p>Form.of是什么，这就要讲到Flutter的InheritedWidget，InheritedWidget是一个方便子Widget获取父Widget提供的属性的Widget。Theme.of、Local.of都是基于InheritedWidget</p>\n</blockquote>\n<h2>FutureBuilder 支持异步加载的Widget</h2>\n<p>一般如何实现异步加载动态更新布局，自然是通过setState改变状态。FutureBuilder就是这么一个封装的Widget，应用在比较单一、一次性的场景</p>\n<div class=\"gatsby-highlight\" data-language=\"dart\"><pre class=\"language-dart\"><code class=\"language-dart\"><span class=\"token keyword\">const</span> <span class=\"token function\">FutureBuilder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  Key key<span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>future<span class=\"token punctuation\">,</span> <span class=\"token comment\">// 异步任务</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>initialData<span class=\"token punctuation\">,</span> <span class=\"token comment\">// 初始数据，不是必要</span>\n  <span class=\"token metadata symbol\">@required</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>builder<span class=\"token punctuation\">,</span> <span class=\"token comment\">// Widget构建</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"dart\"><pre class=\"language-dart\"><code class=\"language-dart\">FutureBuilder<span class=\"token operator\">&lt;</span>String<span class=\"token operator\">></span><span class=\"token punctuation\">(</span>\n  future<span class=\"token punctuation\">:</span> Future<span class=\"token punctuation\">.</span><span class=\"token function\">delayed</span><span class=\"token punctuation\">(</span>\n      <span class=\"token function\">Duration</span><span class=\"token punctuation\">(</span>seconds<span class=\"token punctuation\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token string\">'this is data from net'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  builder<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">,</span> snapshot<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>snapshot<span class=\"token punctuation\">.</span>connectionState <span class=\"token operator\">==</span> ConnectionState<span class=\"token punctuation\">.</span>done<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>snapshot<span class=\"token punctuation\">.</span>hasError<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token function\">Text</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Error: ${snapshot.error}\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 加载失败</span>\n      <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token function\">Text</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Contents: ${snapshot.data}\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 加载成功</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token function\">CircularProgressIndicator</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 加载中</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<blockquote>\n<p>builder会回调多次，原因就是snapshot是一个状态，会改变多次</p>\n</blockquote>\n<h2>WillPopScope 监听Android返回按钮</h2>\n<p>Android才需要的返回按键监听，例如应用在双击返回键退出应用等操作</p>\n<blockquote>\n<p>上面介绍的Form也有一个onWillPop属性，其实就是包了一层WillPopScope</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"dart\"><pre class=\"language-dart\"><code class=\"language-dart\"><span class=\"token keyword\">const</span> <span class=\"token function\">WillPopScope</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  Key key<span class=\"token punctuation\">,</span>\n  <span class=\"token metadata symbol\">@required</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>child<span class=\"token punctuation\">,</span>\n  <span class=\"token metadata symbol\">@required</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>onWillPop<span class=\"token punctuation\">,</span> <span class=\"token comment\">// Future&lt;bool> Function()</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>下面的例子通过WillPopScope包裹AlertDialog来实现一个无法通过返回按键取消的弹窗，只需要onWillPop返回flase即表示屏蔽返回</p>\n<div class=\"gatsby-highlight\" data-language=\"dart\"><pre class=\"language-dart\"><code class=\"language-dart\"><span class=\"token function\">showDialog</span><span class=\"token punctuation\">(</span>\n  context<span class=\"token punctuation\">:</span> context<span class=\"token punctuation\">,</span>\n  barrierDismissible<span class=\"token punctuation\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n  builder<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">WillPopScope</span><span class=\"token punctuation\">(</span>\n      onWillPop<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">async</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n      child<span class=\"token punctuation\">:</span> <span class=\"token function\">AlertDialog</span><span class=\"token punctuation\">(</span>\n        title<span class=\"token punctuation\">:</span> <span class=\"token function\">Text</span><span class=\"token punctuation\">(</span><span class=\"token string\">'弹窗标题'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        content<span class=\"token punctuation\">:</span> <span class=\"token function\">Text</span><span class=\"token punctuation\">(</span><span class=\"token string\">'只能通过关闭按钮关闭'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        actions<span class=\"token punctuation\">:</span> <span class=\"token operator\">&lt;</span>Widget<span class=\"token operator\">></span><span class=\"token punctuation\">[</span>\n          <span class=\"token function\">FlatButton</span><span class=\"token punctuation\">(</span>\n            onPressed<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n              Navigator<span class=\"token punctuation\">.</span><span class=\"token function\">of</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">pop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n            child<span class=\"token punctuation\">:</span> <span class=\"token function\">Text</span><span class=\"token punctuation\">(</span><span class=\"token string\">'关闭'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<h2>Overlay 实现悬浮按钮</h2>\n<blockquote>\n<p>Flutter的路由实际就是用Overlay实现</p>\n<p>可以理解为Flutter的世界只有一个Activity，不同的Page其实就是Fragment堆叠</p>\n<p>所以在Flutter实现全局悬浮按钮简直不要太简单</p>\n</blockquote>\n<blockquote>\n<p>Overlay跟着Navigator一起被创建，所以通过直接Overlay.of取得OverlayState</p>\n</blockquote>\n<p>下面的例子展示如何悬浮一个全局按钮</p>\n<div class=\"gatsby-highlight\" data-language=\"dart\"><pre class=\"language-dart\"><code class=\"language-dart\"><span class=\"token metadata symbol\">@override</span>\n<span class=\"token keyword\">void</span> <span class=\"token function\">initState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">initState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  Future<span class=\"token punctuation\">.</span><span class=\"token function\">delayed</span><span class=\"token punctuation\">(</span><span class=\"token function\">Duration</span><span class=\"token punctuation\">(</span>seconds<span class=\"token punctuation\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    Overlay<span class=\"token punctuation\">.</span><span class=\"token function\">of</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">insert</span><span class=\"token punctuation\">(</span>floatingView<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 插入</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">final</span> floatingView <span class=\"token operator\">=</span> <span class=\"token function\">OverlayEntry</span><span class=\"token punctuation\">(</span>builder<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// OverlayEntry</span>\n  <span class=\"token keyword\">return</span> <span class=\"token function\">FloatingView</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// 悬浮按钮</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">FloatingView</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">StatelessWidget</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token metadata symbol\">@override</span>\n  Widget <span class=\"token function\">build</span><span class=\"token punctuation\">(</span>BuildContext context<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    double size <span class=\"token operator\">=</span> <span class=\"token number\">50</span><span class=\"token punctuation\">;</span>\n    double left <span class=\"token operator\">=</span> MediaQuery<span class=\"token punctuation\">.</span><span class=\"token function\">of</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">.</span>width <span class=\"token operator\">/</span> <span class=\"token number\">4</span> <span class=\"token operator\">-</span> size <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n    double top <span class=\"token operator\">=</span> MediaQuery<span class=\"token punctuation\">.</span><span class=\"token function\">of</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">.</span>height <span class=\"token operator\">/</span> <span class=\"token number\">1.5</span> <span class=\"token operator\">-</span> size <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">ChangeNotifierProvider</span><span class=\"token punctuation\">(</span>\n      create<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token function\">_PositionProvider</span><span class=\"token punctuation\">(</span>size<span class=\"token punctuation\">,</span> left<span class=\"token punctuation\">,</span> top<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      child<span class=\"token punctuation\">:</span> <span class=\"token function\">_PositionObserver</span><span class=\"token punctuation\">(</span>\n        child<span class=\"token punctuation\">:</span> <span class=\"token function\">_PositionConsumer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<blockquote>\n<p>如果需要移除，floatingView.remove()</p>\n<p>利用insert和remove即可实现Flutter层面的Toast</p>\n</blockquote>\n<h2>AbsorbPointer 快速禁止屏幕点击</h2>\n<p>通过AbsorbPointer包裹住RaisedButton，即使RaisedButton声明了点击事件，但是AbsorbPointer也声明了absorbing: true，所有RaisedButton是点不了的</p>\n<div class=\"gatsby-highlight\" data-language=\"dart\"><pre class=\"language-dart\"><code class=\"language-dart\"><span class=\"token function\">AbsorbPointer</span><span class=\"token punctuation\">(</span>\n  absorbing<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 是否吸收触摸事件</span>\n  child<span class=\"token punctuation\">:</span> <span class=\"token function\">RaisedButton</span><span class=\"token punctuation\">(</span>onPressed<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<blockquote>\n<p>Navigator其实也包裹了一层AbsorbPointer，在路由跳转过程，会吸收所有屏幕触摸事件，让跳转完成</p>\n</blockquote>\n<h2>Dismissible 列表Item滑动移除</h2>\n<p>用来实现滑动删除场景</p>\n<div class=\"gatsby-highlight\" data-language=\"dart\"><pre class=\"language-dart\"><code class=\"language-dart\">ListView<span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span>\n  itemCount<span class=\"token punctuation\">:</span> _funItems<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">,</span>\n  itemBuilder<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">Dismissible</span><span class=\"token punctuation\">(</span>\n      key<span class=\"token punctuation\">:</span> <span class=\"token function\">ValueKey</span><span class=\"token punctuation\">(</span>_funItems<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      child<span class=\"token punctuation\">:</span> <span class=\"token function\">Container</span><span class=\"token punctuation\">(</span>\n        color<span class=\"token punctuation\">:</span> Colors<span class=\"token punctuation\">.</span>green<span class=\"token punctuation\">,</span>\n        child<span class=\"token punctuation\">:</span> <span class=\"token function\">ListTile</span><span class=\"token punctuation\">(</span>\n          title<span class=\"token punctuation\">:</span> <span class=\"token function\">Text</span><span class=\"token punctuation\">(</span>_funItems<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      background<span class=\"token punctuation\">:</span> <span class=\"token function\">Container</span><span class=\"token punctuation\">(</span> <span class=\"token comment\">// 右滑背景</span>\n        color<span class=\"token punctuation\">:</span> Colors<span class=\"token punctuation\">.</span>blue<span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      secondaryBackground<span class=\"token punctuation\">:</span> <span class=\"token function\">Container</span><span class=\"token punctuation\">(</span> <span class=\"token comment\">// 左滑背景</span>\n        color<span class=\"token punctuation\">:</span> Colors<span class=\"token punctuation\">.</span>red<span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      onDismissed<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span>decoration<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          _funItems<span class=\"token punctuation\">.</span><span class=\"token function\">removeAt</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<h2>Hero 图片过渡效果</h2>\n<p>在Android 21以上，可以通过给View设置一个flag来让页面跳转时两个View直接有个过渡效果，通常用于浏览大图。在Flutter也是类似</p>\n<div class=\"gatsby-highlight\" data-language=\"dart\"><pre class=\"language-dart\"><code class=\"language-dart\"><span class=\"token keyword\">const</span> <span class=\"token function\">Hero</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  Key key<span class=\"token punctuation\">,</span>\n  <span class=\"token metadata symbol\">@required</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>tag<span class=\"token punctuation\">,</span> <span class=\"token comment\">// String 标记</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>createRectTween<span class=\"token punctuation\">,</span> <span class=\"token comment\">// 过渡动画，默认为MaterialRectArcTween</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>flightShuttleBuilder<span class=\"token punctuation\">,</span> <span class=\"token comment\">// 允许过渡中不使用child</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>placeholderBuilder<span class=\"token punctuation\">,</span> <span class=\"token comment\">// 占位</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>transitionOnUserGestures <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// iOS滑动返回时是否也过渡</span>\n  <span class=\"token metadata symbol\">@required</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>child<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"dart\"><pre class=\"language-dart\"><code class=\"language-dart\"><span class=\"token function\">Hero</span><span class=\"token punctuation\">(</span>\n  tag<span class=\"token punctuation\">:</span> <span class=\"token string\">'hero'</span><span class=\"token punctuation\">,</span>\n  child<span class=\"token punctuation\">:</span> Image<span class=\"token punctuation\">.</span><span class=\"token function\">asset</span><span class=\"token punctuation\">(</span><span class=\"token string\">'images/ic_launcher.png'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<blockquote>\n<p>只需要将Image包裹在Hero中并提供一个tag，在第二个页面同样标记，剩下的就交给Flutter帮我们实现过渡</p>\n</blockquote>\n<h2>FractionallySizedBox 屏幕百分比</h2>\n<p>通常用在某些Widget需要撑满屏幕</p>\n<div class=\"gatsby-highlight\" data-language=\"dart\"><pre class=\"language-dart\"><code class=\"language-dart\"><span class=\"token keyword\">const</span> <span class=\"token function\">FractionallySizedBox</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  Key key<span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>alignment <span class=\"token operator\">=</span> Alignment<span class=\"token punctuation\">.</span>center<span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>widthFactor<span class=\"token punctuation\">,</span> <span class=\"token comment\">// 0-1 1表示撑满</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>heightFactor<span class=\"token punctuation\">,</span>\n  Widget child<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2>SizeBox 控制Widget大小</h2>\n<p>字面意思，向父Widget申请一定大小的空间</p>\n<div class=\"gatsby-highlight\" data-language=\"dart\"><pre class=\"language-dart\"><code class=\"language-dart\"><span class=\"token function\">SizeBox</span><span class=\"token punctuation\">(</span>width<span class=\"token punctuation\">:</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span> height<span class=\"token punctuation\">:</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span> child<span class=\"token punctuation\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span></code></pre></div>\n<ul>\n<li>充当两个Widget直接的Margin</li>\n<li>控制Widget大小</li>\n</ul>\n<h2>Transform 改变Widget形态</h2>\n<p>与Android的作用一致，可以对Widget进行形态上的改变，比如伪3D旋转</p>\n<div class=\"gatsby-highlight\" data-language=\"dart\"><pre class=\"language-dart\"><code class=\"language-dart\"><span class=\"token function\">Transform</span><span class=\"token punctuation\">(</span>\n  alignment<span class=\"token punctuation\">:</span> Alignment<span class=\"token punctuation\">.</span>topRight<span class=\"token punctuation\">,</span>\n  transform<span class=\"token punctuation\">:</span> Matrix4<span class=\"token punctuation\">.</span><span class=\"token function\">skewY</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token function\">rotateZ</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token number\">3.1415926</span> <span class=\"token operator\">/</span> <span class=\"token number\">12.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  child<span class=\"token punctuation\">:</span> <span class=\"token function\">Container</span><span class=\"token punctuation\">(</span>\n    padding<span class=\"token punctuation\">:</span> <span class=\"token keyword\">const</span> EdgeInsets<span class=\"token punctuation\">.</span><span class=\"token function\">all</span><span class=\"token punctuation\">(</span><span class=\"token number\">8.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    color<span class=\"token punctuation\">:</span> <span class=\"token keyword\">const</span> <span class=\"token function\">Color</span><span class=\"token punctuation\">(</span><span class=\"token number\">0xFFE8581C</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    child<span class=\"token punctuation\">:</span> <span class=\"token keyword\">const</span> <span class=\"token function\">Text</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Apartment for rent!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<h2>IndexStack 快速切换Widget</h2>\n<p>例如某个Widget拥有很多种状态，每个状态不同的Icon，通过IndexStack先将所有Icon提供，通过改变index快速切换Icon</p>\n<div class=\"gatsby-highlight\" data-language=\"dart\"><pre class=\"language-dart\"><code class=\"language-dart\"><span class=\"token function\">IndexedStack</span><span class=\"token punctuation\">(</span>\n  index<span class=\"token punctuation\">:</span> _indexStackIndex<span class=\"token punctuation\">,</span>\n  children<span class=\"token punctuation\">:</span> <span class=\"token operator\">&lt;</span>Widget<span class=\"token operator\">></span><span class=\"token punctuation\">[</span>\n    <span class=\"token function\">Icon</span><span class=\"token punctuation\">(</span>Icons<span class=\"token punctuation\">.</span>star<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function\">Icon</span><span class=\"token punctuation\">(</span>Icons<span class=\"token punctuation\">.</span>account_box<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function\">Icon</span><span class=\"token punctuation\">(</span>Icons<span class=\"token punctuation\">.</span>cake<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<blockquote>\n<p>IndexedStack继承Stack，并重写了其渲染部分，只渲染index命中的Icon</p>\n</blockquote>\n<h2>Wrap 流式布局</h2>\n<blockquote>\n<p>Wrap基本与Row/Column一致，不同的一点是当children超出范围的话，Wrap会自动将超出的chilren换行</p>\n</blockquote>\n<p>下面的例子中第三第四个Chip后被layout在第二行</p>\n<div class=\"gatsby-highlight\" data-language=\"dart\"><pre class=\"language-dart\"><code class=\"language-dart\"><span class=\"token function\">Wrap</span><span class=\"token punctuation\">(</span>\n  spacing<span class=\"token punctuation\">:</span> <span class=\"token number\">8.0</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// gap between adjacent chips</span>\n  runSpacing<span class=\"token punctuation\">:</span> <span class=\"token number\">4.0</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// gap between lines</span>\n  children<span class=\"token punctuation\">:</span> <span class=\"token operator\">&lt;</span>Widget<span class=\"token operator\">></span><span class=\"token punctuation\">[</span>\n    <span class=\"token function\">Chip</span><span class=\"token punctuation\">(</span>\n      avatar<span class=\"token punctuation\">:</span> <span class=\"token function\">CircleAvatar</span><span class=\"token punctuation\">(</span>\n          backgroundColor<span class=\"token punctuation\">:</span> Colors<span class=\"token punctuation\">.</span>blue<span class=\"token punctuation\">.</span>shade900<span class=\"token punctuation\">,</span> child<span class=\"token punctuation\">:</span> <span class=\"token function\">Text</span><span class=\"token punctuation\">(</span><span class=\"token string\">'AH'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      label<span class=\"token punctuation\">:</span> <span class=\"token function\">Text</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Hamilton'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function\">Chip</span><span class=\"token punctuation\">(</span>\n      avatar<span class=\"token punctuation\">:</span> <span class=\"token function\">CircleAvatar</span><span class=\"token punctuation\">(</span>\n          backgroundColor<span class=\"token punctuation\">:</span> Colors<span class=\"token punctuation\">.</span>blue<span class=\"token punctuation\">.</span>shade900<span class=\"token punctuation\">,</span> child<span class=\"token punctuation\">:</span> <span class=\"token function\">Text</span><span class=\"token punctuation\">(</span><span class=\"token string\">'ML'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      label<span class=\"token punctuation\">:</span> <span class=\"token function\">Text</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Lafayette'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function\">Chip</span><span class=\"token punctuation\">(</span>\n      avatar<span class=\"token punctuation\">:</span> <span class=\"token function\">CircleAvatar</span><span class=\"token punctuation\">(</span>\n          backgroundColor<span class=\"token punctuation\">:</span> Colors<span class=\"token punctuation\">.</span>blue<span class=\"token punctuation\">.</span>shade900<span class=\"token punctuation\">,</span> child<span class=\"token punctuation\">:</span> <span class=\"token function\">Text</span><span class=\"token punctuation\">(</span><span class=\"token string\">'HM'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      label<span class=\"token punctuation\">:</span> <span class=\"token function\">Text</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Mulligan'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function\">Chip</span><span class=\"token punctuation\">(</span>\n      avatar<span class=\"token punctuation\">:</span> <span class=\"token function\">CircleAvatar</span><span class=\"token punctuation\">(</span>\n          backgroundColor<span class=\"token punctuation\">:</span> Colors<span class=\"token punctuation\">.</span>blue<span class=\"token punctuation\">.</span>shade900<span class=\"token punctuation\">,</span> child<span class=\"token punctuation\">:</span> <span class=\"token function\">Text</span><span class=\"token punctuation\">(</span><span class=\"token string\">'JL'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      label<span class=\"token punctuation\">:</span> <span class=\"token function\">Text</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Laurens'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<h2>PageView Android下的ViewPager</h2>\n<p>估计是开发中最常用到的控件了，具体效果可以看Demo</p>\n<p>在Flutter中，通过PageView+BottomNavigationBar实现</p>\n<div class=\"gatsby-highlight\" data-language=\"dart\"><pre class=\"language-dart\"><code class=\"language-dart\">body<span class=\"token punctuation\">:</span> <span class=\"token function\">PageView</span><span class=\"token punctuation\">(</span> <span class=\"token comment\">// 类似ViewPager</span>\n  physics<span class=\"token punctuation\">:</span> <span class=\"token function\">NeverScrollableScrollPhysics</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 禁止左右滑动</span>\n  controller<span class=\"token punctuation\">:</span> _controller<span class=\"token punctuation\">,</span>\n  children<span class=\"token punctuation\">:</span> <span class=\"token operator\">&lt;</span>Widget<span class=\"token operator\">></span><span class=\"token punctuation\">[</span> <span class=\"token comment\">// 类似Fragment</span>\n    <span class=\"token function\">_DemoHomePageView</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function\">_DemoHomeMyPageView</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  onPageChanged<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span>index<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      _selectedIndex <span class=\"token operator\">=</span> index<span class=\"token punctuation\">;</span> <span class=\"token comment\">// 改变_selectedIndex是为了更新BottomNavigationBar的选中状态</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span>\n\nbottomNavigationBar<span class=\"token punctuation\">:</span> <span class=\"token function\">BottomNavigationBar</span><span class=\"token punctuation\">(</span>\n  items<span class=\"token punctuation\">:</span> <span class=\"token keyword\">const</span> <span class=\"token operator\">&lt;</span>BottomNavigationBarItem<span class=\"token operator\">></span><span class=\"token punctuation\">[</span>\n    <span class=\"token function\">BottomNavigationBarItem</span><span class=\"token punctuation\">(</span>\n      icon<span class=\"token punctuation\">:</span> <span class=\"token function\">Icon</span><span class=\"token punctuation\">(</span>Icons<span class=\"token punctuation\">.</span>home<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      title<span class=\"token punctuation\">:</span> <span class=\"token function\">Text</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Home'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function\">BottomNavigationBarItem</span><span class=\"token punctuation\">(</span>\n      icon<span class=\"token punctuation\">:</span> <span class=\"token function\">Icon</span><span class=\"token punctuation\">(</span>Icons<span class=\"token punctuation\">.</span>person<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      title<span class=\"token punctuation\">:</span> <span class=\"token function\">Text</span><span class=\"token punctuation\">(</span><span class=\"token string\">'My'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  currentIndex<span class=\"token punctuation\">:</span> _selectedIndex<span class=\"token punctuation\">,</span>\n  selectedItemColor<span class=\"token punctuation\">:</span> Colors<span class=\"token punctuation\">.</span>amber<span class=\"token punctuation\">[</span><span class=\"token number\">800</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  onTap<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span>index<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      _selectedIndex <span class=\"token operator\">=</span> index<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    _controller<span class=\"token punctuation\">.</span><span class=\"token function\">jumpToPage</span><span class=\"token punctuation\">(</span>index<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 类似ViewPager.setCurrentPosition</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<blockquote>\n<p>PageView是默认不保活的，可以将_DemoHomePageView混入AutomaticKeepAliveClientMixin并保证build方法调用super</p>\n</blockquote>\n<blockquote>\n<p>混入mixin是什么，可以看dart语法，不同于java单继承，dart的mixin可以扩展属性和方法</p>\n</blockquote>\n<h2>Texture 相机</h2>\n<p>像相机这种需要实时传输大量图像数据的，Flutter提供了Texture，通过映射共享数据的工具</p>\n<div class=\"gatsby-highlight\" data-language=\"dart\"><pre class=\"language-dart\"><code class=\"language-dart\"><span class=\"token keyword\">const</span> <span class=\"token function\">Texture</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  Key key<span class=\"token punctuation\">,</span>\n  <span class=\"token metadata symbol\">@required</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>textureId<span class=\"token punctuation\">,</span> <span class=\"token comment\">// 通过该id获得共享的图像数据</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>filterQuality <span class=\"token operator\">=</span> FilterQuality<span class=\"token punctuation\">.</span>low<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>下面是一个相机例子</p>\n<div class=\"gatsby-highlight\" data-language=\"dart\"><pre class=\"language-dart\"><code class=\"language-dart\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">_TextureBodyState</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">State</span><span class=\"token operator\">&lt;</span>TextureBody<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n  List<span class=\"token operator\">&lt;</span>CameraDescription<span class=\"token operator\">></span> cameras<span class=\"token punctuation\">;</span> <span class=\"token comment\">// 可用的相机集合</span>\n  CameraController cameraController<span class=\"token punctuation\">;</span> <span class=\"token comment\">// 相机控制中枢</span>\n\n  bool <span class=\"token keyword\">get</span> isInit <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">(</span>cameraController<span class=\"token operator\">?</span><span class=\"token punctuation\">.</span>value<span class=\"token operator\">?</span><span class=\"token punctuation\">.</span>isInitialized <span class=\"token operator\">==</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">/// 生成一个文件路径</span>\n  Future<span class=\"token operator\">&lt;</span>String<span class=\"token operator\">></span> <span class=\"token keyword\">get</span> tempFilePath <span class=\"token keyword\">async</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">final</span> cacheDir <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">getTemporaryDirectory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">final</span> dirPath <span class=\"token operator\">=</span> <span class=\"token string\">'${cacheDir.path}/Picture'</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">await</span> <span class=\"token function\">Directory</span><span class=\"token punctuation\">(</span>dirPath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span>recursive<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token string\">'$dirPath/${DateTime.now().millisecondsSinceEpoch.toString()}.jpg'</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  String latestPicturePath<span class=\"token punctuation\">;</span>\n\n  <span class=\"token metadata symbol\">@override</span>\n  <span class=\"token keyword\">void</span> <span class=\"token function\">initState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">initState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">_fetchCameras</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">_fetchCameras</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">{</span>\n    cameras <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">availableCameras</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>cameras<span class=\"token punctuation\">.</span>isNotEmpty<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      cameraController <span class=\"token operator\">=</span> <span class=\"token function\">CameraController</span><span class=\"token punctuation\">(</span>cameras<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> ResolutionPreset<span class=\"token punctuation\">.</span>medium<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">await</span> cameraController<span class=\"token punctuation\">.</span><span class=\"token function\">initialize</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>mounted<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token metadata symbol\">@override</span>\n  <span class=\"token keyword\">void</span> <span class=\"token function\">dispose</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    cameraController<span class=\"token operator\">?</span><span class=\"token punctuation\">.</span><span class=\"token function\">dispose</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">dispose</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token metadata symbol\">@override</span>\n  Widget <span class=\"token function\">build</span><span class=\"token punctuation\">(</span>BuildContext context<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>isInit<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token function\">Container</span><span class=\"token punctuation\">(</span>\n        child<span class=\"token punctuation\">:</span> <span class=\"token function\">Center</span><span class=\"token punctuation\">(</span>\n          child<span class=\"token punctuation\">:</span> <span class=\"token function\">CircularProgressIndicator</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">Container</span><span class=\"token punctuation\">(</span>\n      child<span class=\"token punctuation\">:</span> <span class=\"token function\">Column</span><span class=\"token punctuation\">(</span>\n        crossAxisAlignment<span class=\"token punctuation\">:</span> CrossAxisAlignment<span class=\"token punctuation\">.</span>start<span class=\"token punctuation\">,</span>\n        children<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n          <span class=\"token function\">AspectRatio</span><span class=\"token punctuation\">(</span>\n            aspectRatio<span class=\"token punctuation\">:</span> cameraController<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">.</span>aspectRatio<span class=\"token punctuation\">,</span>\n            child<span class=\"token punctuation\">:</span> <span class=\"token function\">CameraPreview</span><span class=\"token punctuation\">(</span>cameraController<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n          <span class=\"token function\">Expanded</span><span class=\"token punctuation\">(</span>\n            child<span class=\"token punctuation\">:</span> <span class=\"token function\">Row</span><span class=\"token punctuation\">(</span>\n              children<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n                <span class=\"token function\">Expanded</span><span class=\"token punctuation\">(</span>\n                  child<span class=\"token punctuation\">:</span> <span class=\"token function\">Center</span><span class=\"token punctuation\">(</span>\n                    child<span class=\"token punctuation\">:</span> latestPicturePath <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span>\n                        <span class=\"token operator\">?</span> <span class=\"token function\">SizedBox</span><span class=\"token punctuation\">(</span>\n                            width<span class=\"token punctuation\">:</span> <span class=\"token number\">80</span><span class=\"token punctuation\">,</span>\n                            height<span class=\"token punctuation\">:</span> <span class=\"token number\">160</span><span class=\"token punctuation\">,</span>\n                            child<span class=\"token punctuation\">:</span>\n                                Image<span class=\"token punctuation\">.</span><span class=\"token function\">file</span><span class=\"token punctuation\">(</span><span class=\"token function\">File</span><span class=\"token punctuation\">(</span>latestPicturePath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">preview</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                          <span class=\"token punctuation\">)</span>\n                        <span class=\"token punctuation\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\n                  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                <span class=\"token function\">Expanded</span><span class=\"token punctuation\">(</span>\n                  child<span class=\"token punctuation\">:</span> <span class=\"token function\">Center</span><span class=\"token punctuation\">(</span>\n                    child<span class=\"token punctuation\">:</span> <span class=\"token function\">IconButton</span><span class=\"token punctuation\">(</span>\n                      icon<span class=\"token punctuation\">:</span> <span class=\"token function\">Icon</span><span class=\"token punctuation\">(</span>Icons<span class=\"token punctuation\">.</span>camera_alt<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                      onPressed<span class=\"token punctuation\">:</span> isInit\n                          <span class=\"token operator\">?</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">{</span>\n                              <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>cameraController<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">.</span>isTakingPicture<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                                <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n                              <span class=\"token punctuation\">}</span>\n                              <span class=\"token keyword\">final</span> filePath <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> tempFilePath<span class=\"token punctuation\">;</span>\n                              <span class=\"token keyword\">await</span> cameraController<span class=\"token punctuation\">.</span><span class=\"token function\">takePicture</span><span class=\"token punctuation\">(</span>filePath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 拍照</span>\n                              <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>mounted<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                                <span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                                  latestPicturePath <span class=\"token operator\">=</span> filePath<span class=\"token punctuation\">;</span>\n                                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                              <span class=\"token punctuation\">}</span>\n                            <span class=\"token punctuation\">}</span>\n                          <span class=\"token punctuation\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                <span class=\"token function\">Spacer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n              <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2>PlatformView WebView</h2>\n<p>像WebView这种极其复杂的原生控件，用Flutter重新写不太现实，所以Flutter也提供这样一种Widget，将原生控件直接嵌入Flutter的Widget树。</p>\n<p>官方已经提供WebView库帮我们代理了原生WebView</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">webview_flutter</span><span class=\"token punctuation\">:</span> ^0.3.22+1</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"dart\"><pre class=\"language-dart\"><code class=\"language-dart\"><span class=\"token function\">WebView</span><span class=\"token punctuation\">(</span>\n    initialUrl<span class=\"token punctuation\">:</span> widget<span class=\"token punctuation\">.</span>url<span class=\"token punctuation\">,</span>\n    javascriptMode<span class=\"token punctuation\">:</span> JavascriptMode<span class=\"token punctuation\">.</span>unrestricted<span class=\"token punctuation\">,</span> <span class=\"token comment\">// 支持js</span>\n    onWebViewCreated<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span>webViewController<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      _controller<span class=\"token punctuation\">.</span><span class=\"token function\">complete</span><span class=\"token punctuation\">(</span>webViewController<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    javascriptChannels<span class=\"token punctuation\">:</span> <span class=\"token operator\">&lt;</span>JavascriptChannel<span class=\"token operator\">></span><span class=\"token punctuation\">[</span>\n      <span class=\"token function\">_toasterJavascriptChannel</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// js通信</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">toSet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    onPageStarted<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span>String url<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Page started loading: $url'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    onPageFinished<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span>String url<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Page finished loading: $url'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span></code></pre></div>","frontmatter":{"title":"Fun Flutter Widget","date":"August 14, 2020","tags":["flutter","widget"],"categories":"Flutter"}}},"pageContext":{"slug":"/flutter-fun-widget/","previous":{"fields":{"slug":"/flutter-widget-different-from-android-view/"},"frontmatter":{"title":"Android View - Flutter Widget"}},"next":{"fields":{"slug":"/flutter-state/"},"frontmatter":{"title":"Flutter State"}}}},"staticQueryHashes":["2841359383"]}
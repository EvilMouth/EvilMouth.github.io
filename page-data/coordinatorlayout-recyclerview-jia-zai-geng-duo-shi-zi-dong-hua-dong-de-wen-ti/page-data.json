{"componentChunkName":"component---src-templates-blog-post-js","path":"/coordinatorlayout-recyclerview-jia-zai-geng-duo-shi-zi-dong-hua-dong-de-wen-ti/","result":{"data":{"site":{"siteMetadata":{"title":"Evil Mouth","author":{"name":"Evil Mouth"}}},"markdownRemark":{"id":"0836b35e-1115-5563-8ffa-2661e0ba4ae4","excerpt":"记录一下+组合联动时，滑到底部触发加载更多并通过添加数据时，会顺着继续滑动的问题。 问题 GIF…","html":"<p>记录一下<code class=\"language-text\">CoordinatorLayout</code>+<code class=\"language-text\">RecyclerView</code>组合联动时，滑到底部触发加载更多并通过<code class=\"language-text\">notifyItemRangeInserted</code>添加数据时，<code class=\"language-text\">RecyclerView</code>会顺着继续滑动的问题。</p>\n<!-- More -->\n<h1>问题 GIF</h1>\n<p>使用<code class=\"language-text\">CoordinatorLayout</code>联动<code class=\"language-text\">RecyclerView</code>的情况下（普通情况不会），加载更多是通过设置<code class=\"language-text\">多Type</code>的方式注入<code class=\"language-text\">adapter</code>实现的。当快速滑动<code class=\"language-text\">RecyclerView</code>时，通过<code class=\"language-text\">notifyItemRangeInserted</code>插入数据到尾部，则会发生下图所示的情况。</p>\n<p><img src=\"/d7b92ce1acb8ee0c450f5c00af40e4d2/1.gif\"></p>\n<h1>解决之路</h1>\n<h2>焦点问题？</h2>\n<p>在大多数场景是没有使用<code class=\"language-text\">CoordinatorLayout</code>的，正常的使用<code class=\"language-text\">RecyclerView</code>是不会出现这种现象，所以一开始就觉得是<code class=\"language-text\">CoordinatorLayout</code>嵌套的焦点问题，焦点被<code class=\"language-text\">RecyclerView</code>抢夺导致自动滑动（Ps：以前见多了各种<code class=\"language-text\">ScrollView</code>嵌套的焦点问题）。所以给<code class=\"language-text\">CoordinatorLayout</code>做了焦点拦截，直接在布局文件设置属性</p>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\">android:descendantFocusability=\"blocksDescendants\"</code></pre></div>\n<blockquote>\n<p>但是并没有解决问题</p>\n</blockquote>\n<p>之后试了半天布局修改，例如<code class=\"language-text\">android:focusable=&quot;true&quot; android:focusableInTouchMode=&quot;true&quot;</code>等都解决不了问题，只能上网搜搜了。。。</p>\n<h2>positionStart？</h2>\n<p>搜到的第一个类似问题，附带个链接 -> <a href=\"https://stackoverflow.com/questions/27079899/android-notifyitemrangeinserted-disable-autoscroll/30455749\">Link</a></p>\n<p>这位码友也是遇到类似自动滑动的问题，也是添加数据后触发，只不过他的情况是他有个<code class=\"language-text\">多type</code>的头部，所以调用<code class=\"language-text\">notifyItemRangeInserted</code>时的<code class=\"language-text\">positionStart</code>得<code class=\"language-text\">+1</code>，这也提醒我们打代码的时候得多注意，很多神奇的 bug 都是这样来的。。。</p>\n<blockquote>\n<p>也不是解决方案</p>\n</blockquote>\n<h2>RecyclerView 设计初衷？</h2>\n<p>再搜到一个类似问题，再附带链接 -> <a href=\"https://stackoverflow.com/questions/49016668/recyclerview-notifyitemrangeinserted-not-maintaining-scroll-position\">Link</a></p>\n<p>这次这位码友的情况跟我挺相似的，也是利用<code class=\"language-text\">多type</code>实现<code class=\"language-text\">footer</code>，利用这个<code class=\"language-text\">footer</code>实现加载更多的功能，同样插入数据会自动滑动。最佳回答是这样说的：</p>\n<blockquote>\n<p>该码友在有<code class=\"language-text\">footer</code>的时候调用<code class=\"language-text\">notifyItemRangeInserted(0, list.size())</code>时，由于<code class=\"language-text\">footer</code>是唯一存在的第一条<code class=\"language-text\">item</code>，<code class=\"language-text\">RecyclerView</code>为了保持用户视觉体验、能继续看到<code class=\"language-text\">footer</code>，所以自动滑动到<code class=\"language-text\">footer</code>的位置。推荐该码友在<code class=\"language-text\">list.size() == 0</code>时候调用<code class=\"language-text\">notifyDataSetChanged()</code>代替</p>\n</blockquote>\n<blockquote>\n<p>这一现象确实存在，也是平时需要注意的点，但也不是这次的解决方案</p>\n</blockquote>\n<h2>解决！！！</h2>\n<p>再之后找不到相关的问题了，也是自己看了下<code class=\"language-text\">RecyclerView</code>的源码，找到了个方法</p>\n<blockquote>\n<p>recyclerview.stopScroll()</p>\n</blockquote>\n<p>所以最后也是投机取巧的暂时解决这个问题，在插入数据之前停止滚动\n（暂时无法从<code class=\"language-text\">NestedScroll</code>联动滑动机制解决这个问题，如果有大佬知道这个问题解决方案恳请告知一声，下方评论或 Email 我都可以，谢谢）</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">recyclerview<span class=\"token punctuation\">.</span><span class=\"token function\">stopScroll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nadapter<span class=\"token punctuation\">.</span><span class=\"token function\">addList</span><span class=\"token punctuation\">(</span>list<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">addList</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> list<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> index <span class=\"token operator\">=</span> mList<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    mList<span class=\"token punctuation\">.</span><span class=\"token function\">addAll</span><span class=\"token punctuation\">(</span>list<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">notifyItemRangeInserted</span><span class=\"token punctuation\">(</span>index<span class=\"token punctuation\">,</span> list<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><img src=\"/abe9b45adcb057bb27468505e420ad2f/2.gif\"></p>","frontmatter":{"title":"CoordinatorLayout+RecyclerView加载更多时自动滑动的问题","date":"June 15, 2018","tags":["coordinatorLayout","recyclerView","loadMore","scroll"],"categories":"Android"}}},"pageContext":{"slug":"/coordinatorlayout-recyclerview-jia-zai-geng-duo-shi-zi-dong-hua-dong-de-wen-ti/","previous":{"fields":{"slug":"/flutter-stateless-stateful-jie-ou/"},"frontmatter":{"title":"flutter-StatelessWidget与StatefulWidget的解耦"}},"next":{"fields":{"slug":"/android-brower-scheme-app-zong-jie-magic-window-fen-xi/"},"frontmatter":{"title":"Android浏览器们Scheme跳转App总结+魔窗分析"}}}},"staticQueryHashes":["2841359383"]}
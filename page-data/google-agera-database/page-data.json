{"componentChunkName":"component---src-templates-blog-post-js","path":"/google-agera-database/","result":{"data":{"site":{"siteMetadata":{"title":"Evil Mouth","author":{"name":"Evil Mouth"}}},"markdownRemark":{"id":"a78713b2-4a0c-5bc7-9eda-d526196b731b","excerpt":"（内白：第一次真正意义上写博客，这几年来开发路程遇到过许多问题，但都是简单标记一下，并没有记录下来，等过段时间遇到同样问题脑袋一热都忘了又得翻翻翻，特此开始写博客记录我的开发路程，老了，记忆力下降了，再过几年连代码都不会打了。。。 0 0） 进入主题，最近打算用 agera 运用在新项目上，本来打算 rxjava…","html":"<p>（内白：第一次真正意义上写博客，这几年来开发路程遇到过许多问题，但都是简单标记一下，并没有记录下来，等过段时间遇到同样问题脑袋一热都忘了又得翻翻翻，特此开始写博客记录我的开发路程，老了，记忆力下降了，再过几年连代码都不会打了。。。 0 0）</p>\n<p>进入主题，最近打算用 agera 运用在新项目上，本来打算 rxjava，貌似个个都在用。。但是对比了一下 agera 和 rxjava，感觉在 android 上使用 agera 更适合，个人觉得 rxjava 的确很强大，但是操作符有点乱，什么 action1、action2，虽然后面 rxjava2 更改并加强了概念，还是觉得使用起来有时候会忘记，况且 agera 跟 android 生命周期绑定，所以选择了 agera</p>\n<p>那么开始吧，先从常用的 sqlite 入手</p>\n<h3>依赖</h3>\n<p>Google 官网出了一个 database 的库，就是基于 Agera 概念封装了一下 sqlite，使用方法如下</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">compile 'com<span class=\"token punctuation\">.</span>google<span class=\"token punctuation\">.</span>android<span class=\"token punctuation\">.</span>agera<span class=\"token operator\">:</span>agera<span class=\"token operator\">:</span><span class=\"token number\">1.2</span><span class=\"token number\">.0</span>'\ncompile 'com<span class=\"token punctuation\">.</span>google<span class=\"token punctuation\">.</span>android<span class=\"token punctuation\">.</span>agera<span class=\"token operator\">:</span>database<span class=\"token operator\">:</span><span class=\"token number\">1.2</span><span class=\"token number\">.0</span>'</code></pre></div>\n<p>Agera Github 地址: <a href=\"https://github.com/google/agera\">https://github.com/google/agera</a>\n还有中文翻译: <a href=\"https://github.com/captain-miao/AndroidAgeraTutorial/wiki\">https://github.com/captain-miao/AndroidAgeraTutorial/wiki</a></p>\n<!-- more -->\n<h3>首先是创建一个 SQLiteOpenHelper</h3>\n<p>这里 database 库里有个<code class=\"language-text\">SqlDatabaseSupplier</code>帮我们继承了<code class=\"language-text\">SQLiteOpenHelper</code>并且实现了一个<code class=\"language-text\">Supplier</code>接口(这个 Supplier 接口是使用 agera 必须实现的)，所以直接继承<code class=\"language-text\">SqlDatabaseSupplier</code>就行了</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">BikeDBHelper</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">SqlDatabaseSupplier</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> <span class=\"token constant\">DB_NAME</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"DB.db\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> <span class=\"token constant\">TABLE_NAME</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"Bikes\"</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">BikeDBHelper</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@NonNull</span> <span class=\"token class-name\">Context</span> context<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">,</span> <span class=\"token constant\">DB_NAME</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onCreate</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SQLiteDatabase</span> db<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">String</span> sql <span class=\"token operator\">=</span> <span class=\"token string\">\"create table if not exists \"</span> <span class=\"token operator\">+</span> <span class=\"token constant\">TABLE_NAME</span> <span class=\"token operator\">+</span> <span class=\"token string\">\" (id integer primary key,num text)\"</span><span class=\"token punctuation\">;</span>\n        db<span class=\"token punctuation\">.</span><span class=\"token function\">execSQL</span><span class=\"token punctuation\">(</span>sql<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">//插入两条数据模拟一下</span>\n        db<span class=\"token punctuation\">.</span><span class=\"token function\">execSQL</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"insert into \"</span> <span class=\"token operator\">+</span> <span class=\"token constant\">TABLE_NAME</span> <span class=\"token operator\">+</span> <span class=\"token string\">\" (id,num) values (1,'123456')\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        db<span class=\"token punctuation\">.</span><span class=\"token function\">execSQL</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"insert into \"</span> <span class=\"token operator\">+</span> <span class=\"token constant\">TABLE_NAME</span> <span class=\"token operator\">+</span> <span class=\"token string\">\" (id,num) values (2,'254365')\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onUpgrade</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SQLiteDatabase</span> db<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> oldVersion<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> newVersion<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">//do nothing</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>下面是<code class=\"language-text\">SqlDatabaseSupplier</code>的源码，很简单</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">/**\n * Abstract extension of {@link SQLiteOpenHelper} implementing a sql database {@link Supplier} to be\n * used with the {@link SqlDatabaseFunctions}.\n */</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">abstract</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SqlDatabaseSupplier</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">SQLiteOpenHelper</span>\n    <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Supplier</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Result</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">SQLiteDatabase</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token comment\">/**\n   * Extending the base constructor, for overriding in concrete implementations.\n   */</span>\n  <span class=\"token keyword\">public</span> <span class=\"token class-name\">SqlDatabaseSupplier</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@NonNull</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">Context</span> context<span class=\"token punctuation\">,</span> <span class=\"token annotation punctuation\">@NonNull</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> path<span class=\"token punctuation\">,</span>\n      <span class=\"token annotation punctuation\">@Nullable</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">CursorFactory</span> factory<span class=\"token punctuation\">,</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> version<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">,</span> path<span class=\"token punctuation\">,</span> factory<span class=\"token punctuation\">,</span> version<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token annotation punctuation\">@NonNull</span>\n  <span class=\"token annotation punctuation\">@Override</span>\n  <span class=\"token keyword\">public</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">synchronized</span> <span class=\"token class-name\">Result</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">SQLiteDatabase</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token function\">absentIfNull</span><span class=\"token punctuation\">(</span><span class=\"token function\">getWritableDatabase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">SQLException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token function\">failure</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3>创建 Repository</h3>\n<p>在 agera 最重要的就是这个<code class=\"language-text\">Repository</code>了，先从查询开始</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token class-name\">Repository</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Result</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">List</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Bike</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span> query <span class=\"token operator\">=</span> <span class=\"token class-name\">Repositories</span><span class=\"token punctuation\">.</span><span class=\"token function\">repositoryWithInitialValue</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Result</span><span class=\"token punctuation\">.</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">List</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Bike</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span><span class=\"token function\">absent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">observe</span><span class=\"token punctuation\">(</span>onSearchObservable<span class=\"token punctuation\">)</span><span class=\"token comment\">//这里观察一个按钮，点击按钮就获取一次</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">onUpdatesPerLoop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token comment\">//刷新频率</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">getFrom</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Supplier</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token annotation punctuation\">@NonNull</span>\n                    <span class=\"token annotation punctuation\">@Override</span>\n                    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                        <span class=\"token keyword\">return</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span><span class=\"token comment\">//可以是查询条件</span>\n                    <span class=\"token punctuation\">}</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">goTo</span><span class=\"token punctuation\">(</span><span class=\"token constant\">EXECUTOR</span><span class=\"token punctuation\">)</span><span class=\"token comment\">//异步</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">transform</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Function</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">SqlRequest</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token annotation punctuation\">@NonNull</span>\n                    <span class=\"token annotation punctuation\">@Override</span>\n                    <span class=\"token keyword\">public</span> <span class=\"token class-name\">SqlRequest</span> <span class=\"token function\">apply</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@NonNull</span> <span class=\"token class-name\">String</span> input<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    \t<span class=\"token comment\">//这里的input就是getFrom返回的字符串，可以是查询条件，根据查询条件创建不同的SqlRequest</span>\n                        <span class=\"token keyword\">return</span> <span class=\"token class-name\">SqlRequests</span><span class=\"token punctuation\">.</span><span class=\"token function\">sqlRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                                        <span class=\"token punctuation\">.</span><span class=\"token function\">sql</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"SELECT * FROM \"</span> <span class=\"token operator\">+</span> <span class=\"token class-name\">BikeDBHelper</span><span class=\"token punctuation\">.</span><span class=\"token constant\">TABLE_NAME</span><span class=\"token punctuation\">)</span>\n                                        <span class=\"token punctuation\">.</span><span class=\"token function\">compile</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">}</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">thenTransform</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SqlDatabaseFunctions</span><span class=\"token punctuation\">.</span><span class=\"token function\">databaseQueryFunction</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">BikeDBHelper</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Function</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Cursor</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Bike</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token annotation punctuation\">@NonNull</span>\n                    <span class=\"token annotation punctuation\">@Override</span>\n                    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Bike</span> <span class=\"token function\">apply</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@NonNull</span> <span class=\"token class-name\">Cursor</span> cursor<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Bike</span><span class=\"token punctuation\">(</span>\n                                cursor<span class=\"token punctuation\">.</span><span class=\"token function\">getString</span><span class=\"token punctuation\">(</span>cursor<span class=\"token punctuation\">.</span><span class=\"token function\">getColumnIndex</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"num\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token punctuation\">}</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">compile</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>重点就是最后一步<code class=\"language-text\">thenTransform</code>，将<code class=\"language-text\">SqlRequest</code>转换成<code class=\"language-text\">Result&lt;List&lt;Bike>></code>。官网提供了<code class=\"language-text\">SqlDatabaseFunctions</code>类，里面有数据库增删改查四个方法，这里用到的就是查询<code class=\"language-text\">databaseQueryFunction</code>方法，通过传入一个<code class=\"language-text\">Supplier&lt;Result&lt;SQLiteDatabase>></code>，就是一开始创建的<code class=\"language-text\">BikeDBHelper</code>，还传入一个<code class=\"language-text\">Function</code>将里面处理好的游标<code class=\"language-text\">Cursor</code>提供给我们去获取转换成该游标下的数据，至此转换成最后需要的<code class=\"language-text\">Result&lt;List&lt;Bike>></code></p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">/**\n   * Creates a sql query {@link Function}.\n   */</span>\n  <span class=\"token annotation punctuation\">@NonNull</span>\n  <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token class-name\">Function</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">SqlRequest</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Result</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">List</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span> <span class=\"token function\">databaseQueryFunction</span><span class=\"token punctuation\">(</span>\n      <span class=\"token annotation punctuation\">@NonNull</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">Supplier</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Result</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">SQLiteDatabase</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span> database<span class=\"token punctuation\">,</span>\n      <span class=\"token annotation punctuation\">@NonNull</span> <span class=\"token class-name\">Function</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Cursor</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> rowMap<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DatabaseFunction</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span>database<span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DatabaseQueryMerger</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span>rowMap<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span></code></pre></div>\n<h3>push event</h3>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onResume</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">onResume</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        query<span class=\"token punctuation\">.</span><span class=\"token function\">addUpdatable</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n<span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onPause</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">onPause</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        query<span class=\"token punctuation\">.</span><span class=\"token function\">removeUpdatable</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<h3>pull data</h3>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">update</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        query<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">ifSucceededSendTo</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">accept</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@NonNull</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Bike</span><span class=\"token punctuation\">></span></span> value<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        mMainAdapter<span class=\"token punctuation\">.</span><span class=\"token function\">setList</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<h3>总结</h3>\n<p>创建<code class=\"language-text\">Repository</code>过程中涉及到一个<code class=\"language-text\">SqlRequest</code>，这其实就是一个查询 request，针对增删改还有<code class=\"language-text\">SqlInsertRequest``SqlDeleteRequest``SqlUpdateRequest</code>一共四种 request，都是通过<code class=\"language-text\">SqlRequests</code>创建。其实整个 database 库很小，一共也就几个类，所以使用起来还是挺方便的，重点还是得理解 Repository。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"https://cdn.jsdelivr.net/gh/EvilMouth/EvilMouth.github.io@gh-pages/static/a5eeae8a41e4b3489a5a20d78a193e15/6e6fb/1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 85.13513513513513%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAIAAABSJhvpAAAACXBIWXMAAAsTAAALEwEAmpwYAAACcElEQVR42nWSe0/bMBTF+VCTGBtp3rHrxGmclxPHj9ihZYOWAaOIwjSQJu1zTykIutFJR/e/n865596DaTwTdXp1tmg73nW8blqUpGlW4Cy3LHdie5OJN07bf68D4FnZLOY1vj6lbVNyVjGaN2WKgJcmIIEBRmEMPeAeQ9+CvgW8UdCfoMg5iCMHhTbBkWjIal6plqi2UF3dc8qqjDeFYCVv83E2BaNEdbXiFauz+BmOIzuBHp76dBas1uv+7KTj5HSutWq1bJWgRQqbalaRuMwQLXBd4pKgV3g0jyPXP/6w2vwy68usCoeeK0HlGKHGUy8BLoZeHDnQt6a+NQ0mb3AcOQlwoXO0WN/qm2VegnkvBsWMbBWnWrZatHMjGCVbmxfkDY5H+FN7YeTVl7yEQ8+1arSgkpWS0162WjZZHO2HE+AB53B192S+r0g5xu6fbVUrukqJhqTgzWkPbB8uN49mfVFUYK5F31Gt2NB3RnWqowlwd233wKvNo7m5IAVYaNnzWrSl6qq2zuo8+YfcB98/Dd8vSBnNjTKykYIymo0NhxMM3QSM+i/89e6nOVuROFycqO229fOpjWRGsudTvUbYgaEbTT4vHtRwL/McnQ7KKCZ5va2tMdvNjeoG3RH80vlfdwb2x+XDxqzP8wouBqlVI3gleZ1hMIvDLAlJCooZxFMvDp3dD3NQ5Eb24bcfv09ur0kZzrUy2/fUPStnKMcwRcE0mKDtb73FRqGTQjfHAXCPzPJSLud5AbRgvaB9RyWretEMfVe9K/wARQ4I7HIWnmtCMoSgg1GIY5CgMEEB8I+Bb4HAAv7xNLRR5OzqD2GSP4nucANSAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"1\"\n        title=\"\"\n        src=\"https://cdn.jsdelivr.net/gh/EvilMouth/EvilMouth.github.io@gh-pages/static/a5eeae8a41e4b3489a5a20d78a193e15/fcda8/1.png\"\n        srcset=\"https://cdn.jsdelivr.net/gh/EvilMouth/EvilMouth.github.io@gh-pages/static/a5eeae8a41e4b3489a5a20d78a193e15/12f09/1.png 148w,\nhttps://cdn.jsdelivr.net/gh/EvilMouth/EvilMouth.github.io@gh-pages/static/a5eeae8a41e4b3489a5a20d78a193e15/e4a3f/1.png 295w,\nhttps://cdn.jsdelivr.net/gh/EvilMouth/EvilMouth.github.io@gh-pages/static/a5eeae8a41e4b3489a5a20d78a193e15/fcda8/1.png 590w,\nhttps://cdn.jsdelivr.net/gh/EvilMouth/EvilMouth.github.io@gh-pages/static/a5eeae8a41e4b3489a5a20d78a193e15/6e6fb/1.png 618w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>","frontmatter":{"title":"初试Google Agera database","date":"February 10, 2017","tags":["agera"],"categories":"Android"}}},"pageContext":{"id":"a78713b2-4a0c-5bc7-9eda-d526196b731b","previousPostId":"e01c161d-0809-53fd-9641-36bfaa63d2ec","nextPostId":"de98721e-1ef7-5c43-bc4a-742787985ac5"}},"staticQueryHashes":["2841359383"],"slicesMap":{}}